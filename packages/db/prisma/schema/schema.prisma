generator client {
  provider     = "prisma-client"
  output       = "../generated"
  moduleFormat = "esm"
  runtime      = "bun"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  creator
  contestee
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      UserRole @default(creator)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  contests        Contests[]
  mcq_submissions McqSubmissions[]
  dsa_submissions DsaSubmissions[]
}

model Contests {
  id          String   @id @default(uuid())
  title       String
  description String
  creator_id  String
  start_time  DateTime
  end_time    DateTime
  created_at  DateTime @default(now())

  creator User @relation(fields: [creator_id], references: [id])

  mcq_questions McqQuestions[]
  dsa_problems  DsaProblems[]
}

model McqQuestions {
  id                   String   @id @default(uuid())
  contest_id           String
  question_text        String
  options              Json
  correct_option_index Int
  points               Int      @default(1)
  created_at           DateTime @default(now())

  contest         Contests         @relation(fields: [contest_id], references: [id])
  mcq_submissions McqSubmissions[]
}

model DsaProblems {
  id           String   @id @default(uuid())
  contest_id   String
  title        String
  description  String
  tags         Json
  points       Int      @default(100)
  time_limit   Int      @default(2000)
  memory_limit Int      @default(256)
  created_at   DateTime @default(now())
  
  contest         Contests         @relation(fields: [contest_id], references: [id])
  dsa_submissions DsaSubmissions[]
  test_cases TestCases[]
}

model TestCases {
  id              String   @id @default(uuid())
  problem_id      String
  input           String[]
  expected_output String[]
  is_hidden       Boolean  @default(false)
  created_at      DateTime @default(now())

  problem DsaProblems @relation(fields: [problem_id], references: [id])
}

model McqSubmissions {
  id                    String   @id @default(uuid())
  user_id               String
  question_id           String
  selected_option_index Int
  is_correct            Boolean
  points_earned         Int
  submitted_at          DateTime @default(now())

  user     User         @relation(fields: [user_id], references: [id])
  question McqQuestions @relation(fields: [question_id], references: [id])

  @@unique([user_id, question_id])
  @@index([user_id, question_id])
}

model DsaSubmissions {
  id                String   @id @default(uuid())
  user_id           String
  problem_id        String
  code              String   @db.Text
  language          String
  status            String
  points_earned     Int      @default(0)
  test_cases_passed Int      @default(0)
  total_test_cases  Int      @default(0)
  execution_time    Int
  submitted_at      DateTime @default(now())

  user    User        @relation(fields: [user_id], references: [id])
  problem DsaProblems @relation(fields: [problem_id], references: [id])
}
